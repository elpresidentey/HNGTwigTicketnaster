{% extends "base.twig" %}

{% block title %}Tickets - Ticket Management App{% endblock %}

{% block head %}
    {# Modern Tickets styles #}
    <link rel="stylesheet" href="/assets/css/tickets-modern.css">
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Page Header -->
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">Ticket Management</h1>
                    <p class="mt-2 text-gray-600">Manage and track your tickets</p>
                </div>
                <button id="createTicketBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200 flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    Create New Ticket
                </button>
            </div>
        </div>

        <!-- Ticket Controls -->
        <div class="mb-6">
            <div class="flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between">
                <div class="flex flex-wrap gap-2">
                    <button class="filter-btn active" data-status="all">All Tickets</button>
                    <button class="filter-btn" data-status="Open">
                        <span class="status-indicator bg-green-500"></span>
                        Open
                    </button>
                    <button class="filter-btn" data-status="In Progress">
                        <span class="status-indicator bg-amber-500"></span>
                        In Progress
                    </button>
                    <button class="filter-btn" data-status="Closed">
                        <span class="status-indicator bg-gray-500"></span>
                        Closed
                    </button>
                </div>
                <div class="flex items-center gap-2">
                    <label for="sortSelect" class="text-sm text-gray-600">Sort by:</label>
                    <select id="sortSelect" class="border border-gray-300 rounded-md px-3 py-1 text-sm">
                        <option value="newest">Newest First</option>
                        <option value="oldest">Oldest First</option>
                        <option value="title">Title A-Z</option>
                        <option value="status">Status</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Ticket Container -->
        <div id="ticketContainer" class="space-y-4">
            <!-- Tickets will be rendered here by JavaScript -->
        </div>

        <!-- Empty State Template -->
        <div id="emptyState" class="hidden text-center py-16">
            <div class="max-w-md mx-auto">
                <svg class="mx-auto h-24 w-24 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <h3 class="mt-4 text-lg font-medium text-gray-900">No tickets yet</h3>
                <p class="mt-2 text-gray-500">Get started by creating your first ticket to track issues and tasks.</p>
                <button id="createFirstTicketBtn" class="mt-6 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200">
                    Create Your First Ticket
                </button>
            </div>
        </div>

        <!-- Ticket Card Template (Hidden, used by JavaScript) -->
        <template id="ticketCardTemplate">
            <div class="ticket-card bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow duration-200" data-ticket-id="">
                <div class="flex items-start justify-between mb-4">
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2">
                            <h3 class="ticket-title text-lg font-semibold text-gray-900 truncate"></h3>
                            <span class="ticket-status-badge px-3 py-1 rounded-full text-sm font-medium">
                                <span class="status-indicator w-2 h-2 rounded-full inline-block mr-2"></span>
                                <span class="status-text"></span>
                            </span>
                        </div>
                        <p class="ticket-description text-gray-600 text-sm line-clamp-2"></p>
                    </div>
                    <div class="flex items-center gap-2 ml-4">
                        <button class="edit-ticket-btn text-gray-400 hover:text-blue-600 transition-colors duration-200" title="Edit ticket">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                        </button>
                        <button class="delete-ticket-btn text-gray-400 hover:text-red-600 transition-colors duration-200" title="Delete ticket">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="flex items-center justify-between text-sm text-gray-500">
                    <span class="ticket-created">Created: <span class="created-date"></span></span>
                    <span class="ticket-updated">Updated: <span class="updated-date"></span></span>
                </div>
            </div>
        </template>
    </div>

    <!-- Create Ticket Modal -->
    <div id="createTicketModal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="modal-content bg-white rounded-lg shadow-xl max-w-md w-full mx-4 max-h-screen overflow-y-auto">
            <div class="modal-header flex items-center justify-between p-6 border-b border-gray-200">
                <h2 class="text-xl font-semibold text-gray-900">Create New Ticket</h2>
                <button id="closeCreateModal" class="text-gray-400 hover:text-gray-600 transition-colors duration-200">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <form id="createTicketForm" class="p-6">
                <div class="space-y-4">
                    <!-- Title Field -->
                    <div>
                        <label for="createTitle" class="block text-sm font-medium text-gray-700 mb-2">
                            Title <span class="text-red-500">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="createTitle" 
                            name="title" 
                            required 
                            maxlength="100"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Enter ticket title"
                        >
                        <div class="error-message hidden text-red-600 text-sm mt-1" id="createTitleError"></div>
                        <div class="text-xs text-gray-500 mt-1">
                            <span id="createTitleCount">0</span>/100 characters
                        </div>
                    </div>

                    <!-- Status Field -->
                    <div>
                        <label for="createStatus" class="block text-sm font-medium text-gray-700 mb-2">
                            Status <span class="text-red-500">*</span>
                        </label>
                        <select 
                            id="createStatus" 
                            name="status" 
                            required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                            <option value="Open">Open</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Closed">Closed</option>
                        </select>
                        <div class="error-message hidden text-red-600 text-sm mt-1" id="createStatusError"></div>
                    </div>

                    <!-- Description Field -->
                    <div>
                        <label for="createDescription" class="block text-sm font-medium text-gray-700 mb-2">
                            Description
                        </label>
                        <textarea 
                            id="createDescription" 
                            name="description" 
                            rows="4" 
                            maxlength="500"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-vertical"
                            placeholder="Enter ticket description (optional)"
                        ></textarea>
                        <div class="error-message hidden text-red-600 text-sm mt-1" id="createDescriptionError"></div>
                        <div class="text-xs text-gray-500 mt-1">
                            <span id="createDescriptionCount">0</span>/500 characters
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="flex justify-end gap-3 mt-6 pt-4 border-t border-gray-200">
                    <button 
                        type="button" 
                        id="cancelCreateTicket"
                        class="px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors duration-200"
                    >
                        Cancel
                    </button>
                    <button 
                        type="submit"
                        class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors duration-200 flex items-center gap-2"
                    >
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        Create Ticket
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Ticket Modal -->
    <div id="editTicketModal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="modal-content bg-white rounded-lg shadow-xl max-w-md w-full mx-4 max-h-screen overflow-y-auto">
            <div class="modal-header flex items-center justify-between p-6 border-b border-gray-200">
                <h2 class="text-xl font-semibold text-gray-900">Edit Ticket</h2>
                <button id="closeEditModal" class="text-gray-400 hover:text-gray-600 transition-colors duration-200">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <form id="editTicketForm" class="p-6">
                <input type="hidden" id="editTicketId" name="id">
                <div class="space-y-4">
                    <!-- Title Field -->
                    <div>
                        <label for="editTitle" class="block text-sm font-medium text-gray-700 mb-2">
                            Title <span class="text-red-500">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="editTitle" 
                            name="title" 
                            required 
                            maxlength="100"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Enter ticket title"
                        >
                        <div class="error-message hidden text-red-600 text-sm mt-1" id="editTitleError"></div>
                        <div class="text-xs text-gray-500 mt-1">
                            <span id="editTitleCount">0</span>/100 characters
                        </div>
                    </div>

                    <!-- Status Field -->
                    <div>
                        <label for="editStatus" class="block text-sm font-medium text-gray-700 mb-2">
                            Status <span class="text-red-500">*</span>
                        </label>
                        <select 
                            id="editStatus" 
                            name="status" 
                            required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                            <option value="Open">Open</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Closed">Closed</option>
                        </select>
                        <div class="error-message hidden text-red-600 text-sm mt-1" id="editStatusError"></div>
                    </div>

                    <!-- Description Field -->
                    <div>
                        <label for="editDescription" class="block text-sm font-medium text-gray-700 mb-2">
                            Description
                        </label>
                        <textarea 
                            id="editDescription" 
                            name="description" 
                            rows="4" 
                            maxlength="500"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-vertical"
                            placeholder="Enter ticket description (optional)"
                        ></textarea>
                        <div class="error-message hidden text-red-600 text-sm mt-1" id="editDescriptionError"></div>
                        <div class="text-xs text-gray-500 mt-1">
                            <span id="editDescriptionCount">0</span>/500 characters
                        </div>
                    </div>

                    <!-- Metadata Display -->
                    <div class="bg-gray-50 rounded-md p-3">
                        <div class="text-sm text-gray-600 space-y-1">
                            <div>Created: <span id="editCreatedDate" class="font-medium"></span></div>
                            <div>Last Updated: <span id="editUpdatedDate" class="font-medium"></span></div>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="flex justify-end gap-3 mt-6 pt-4 border-t border-gray-200">
                    <button 
                        type="button" 
                        id="cancelEditTicket"
                        class="px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors duration-200"
                    >
                        Cancel
                    </button>
                    <button 
                        type="submit"
                        class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors duration-200 flex items-center gap-2"
                    >
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        Update Ticket
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmModal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="modal-content bg-white rounded-lg shadow-xl max-w-sm w-full mx-4">
            <div class="p-6">
                <div class="flex items-center mb-4">
                    <div class="flex-shrink-0">
                        <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-lg font-medium text-gray-900">Delete Ticket</h3>
                        <p class="text-sm text-gray-500 mt-1">Are you sure you want to delete this ticket? This action cannot be undone.</p>
                    </div>
                </div>
                <div class="bg-gray-50 rounded-md p-3 mb-4">
                    <p class="text-sm font-medium text-gray-900" id="deleteTicketTitle"></p>
                    <p class="text-xs text-gray-600 mt-1" id="deleteTicketStatus"></p>
                </div>
                <div class="flex justify-end gap-3">
                    <button 
                        type="button" 
                        id="cancelDeleteTicket"
                        class="px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors duration-200"
                    >
                        Cancel
                    </button>
                    <button 
                        type="button"
                        id="confirmDeleteTicket"
                        class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md transition-colors duration-200 flex items-center gap-2"
                    >
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                        Delete
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Ticket-specific styles */
.filter-btn {
    @apply px-4 py-2 rounded-lg text-sm font-medium border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 transition-colors duration-200 flex items-center gap-2;
}

.filter-btn.active {
    @apply bg-blue-600 text-white border-blue-600 hover:bg-blue-700;
}

.status-indicator {
    @apply w-2 h-2 rounded-full inline-block;
}

.ticket-status-badge {
    @apply flex items-center;
}

/* Status-specific colors */
.status-open .status-indicator,
.status-open .ticket-status-badge {
    @apply bg-green-100 text-green-800;
}

.status-open .status-indicator {
    @apply bg-green-500;
}

.status-in-progress .status-indicator,
.status-in-progress .ticket-status-badge {
    @apply bg-amber-100 text-amber-800;
}

.status-in-progress .status-indicator {
    @apply bg-amber-500;
}

.status-closed .status-indicator,
.status-closed .ticket-status-badge {
    @apply bg-gray-100 text-gray-800;
}

.status-closed .status-indicator {
    @apply bg-gray-500;
}

/* Line clamp utility for description */
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* Modal styles */
.modal {
    backdrop-filter: blur(4px);
}

.modal.show {
    display: flex !important;
}

.modal-content {
    animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* Form validation styles */
.error-message {
    display: none;
}

.error-message.show {
    display: block;
}

.field-error {
    @apply border-red-500 focus:ring-red-500 focus:border-red-500;
}

/* Character counter styles */
.char-limit-warning {
    @apply text-amber-600;
}

.char-limit-exceeded {
    @apply text-red-600 font-medium;
}

/* Responsive grid for tickets */
@media (min-width: 768px) {
    #ticketContainer {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        gap: 1rem;
    }
    
    #ticketContainer .space-y-4 > * + * {
        margin-top: 0;
    }
}

@media (min-width: 1024px) {
    #ticketContainer {
        grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
        gap: 1.5rem;
    }
}

/* Mobile responsive adjustments */
@media (max-width: 640px) {
    .modal-content {
        margin: 1rem;
        max-height: calc(100vh - 2rem);
    }
    
    .ticket-card {
        padding: 1rem;
    }
    
    .ticket-card .flex {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
    }
    
    .ticket-card .ml-4 {
        margin-left: 0;
        align-self: flex-end;
    }
}
</style>
{% endblock %}